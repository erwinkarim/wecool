<%- model_class = Photo -%>
<div class="page-header row-fluid">
  <div class="span2"><%= link_to image_tag('http://placehold.it/75x75'), '#', :class=>'pull-right'  %></div>
  <h1 class="span10"><%=t '.title', :default => model_class.model_name.human.pluralize %> by <%= current_persona == @persona ? 'you' : @persona.screen_name %></h1>
</div>
<% if persona_signed_in? && current_persona != @persona then %>
  <div class="row-fluid trackBox">
    <% if current_persona.tracks 'persona', @persona then %>
      Tracking <%= @persona.screen_name %> - <%= link_to 'Untrack', tracker_untrack_path('persona', @persona), :remote=> true, :method=> :post %>
    <% else %>
          <%= link_to 'Track photos by ' + @persona.screen_name, tracker_track_path('persona', @persona ), :remote=>true, :method => :post %>
    <% end %>
  </div>
  <br />
<% end %>
<div class="row-fluid">
  <% if @persona.photos.empty? then %>
    <div>
      <% if current_persona == @persona then %>
        <h3>You don't have any photos yet <%= link_to 'upload some', new_photo_path %></h3>
      <% else %>
        <h3>No photos yet...
      <% end %>
    </div>
  <% else %>
    <div class="row-fluid">
      <ul class="nav nav-tabs" id="photoTypeSelectorTab">
        <li class="<%= params[:view] == 'featured' || !(params.has_key? :view) ? 'active' : '' %> featured-photos"><a href="#">Featured</a>
        <li class="<%= params[:view] == 'raw' ? 'active' : '' %> all-photos"><a href="#">Raw</a>
      </ul>
    </div>
    <div class="row-fluid endless-photos" last="<%= @last_photo.id %>">
      <div class="last-div endless_scroll_inner_wrap"></div>
    </div>
  <% end %>
</div>
<script type="text/javascript">
  var isFeatured = $('.featured-photos').hasClass('active') ? 'true' : ['true', 'false'];

  //get the first few
  $.ajax({
    url: '/photos/get_more/<%= @last_photo.id %>', 
    data: {limit:10, includeFirst:'true', size:'small', author:'<%= @persona.screen_name %>', featured:isFeatured }, 
    dataType: 'script'
  });
  
  //keep loading until the end
  $(document).endlessScroll({
    fireOnce: true,
    fireDelay: 500, 
    bottomPixels: 250, 
    intervalFrequency: 100, 
    ceaseFireOnEmpty: false, 
    ceaseFire: function(){
      return $('.last-div').length ? false : true;
    }, 
    loader: '<div>loading...</div>', 
    callback: function(){
        $.ajax({
          url: '/photos/get_more/'+$('.endless-photos').attr('last'), 
          data: {limit:10, size:'small', author:'<%= @persona.screen_name %>', featured:isFeatured}, 
          dataType: 'script'
        });
    }, 
    ceaseFire: function(s){
      s<5 ? false : true;
    }
  });
  
  $(document).ready(function(){
   $('#photoTypeSelectorTab li').click( function(){
      $('.active').toggleClass('active');
      $(this).toggleClass('active');
      //reload the photos

      $('.carousel').detach();
      isFeatured = $('.featured-photos').hasClass('active') ? 'true' : ['true', 'false'];

      $.ajax({
        url: '/photos/get_more/<%= @last_photo.id %>', 
        data: {limit:10, includeFirst:'true', size:'small', author:'<%= @persona.screen_name %>', featured:isFeatured }, 
        dataType: 'script'
      });
    }); 
  });
</script>
</script>

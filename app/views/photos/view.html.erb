<%- model_class = Photo -%>

<!-- pagae header-->
<div class="page-header">
  <h1 id="photo-title"><%= @photo.title == nil ? 'Untitled' : @photo.title %></h1>
  <% if persona_signed_in? && current_persona.id == @persona.id then %>
    <%= form_for @photo, :html => { :id => 'photo-title-form', :class => 'form-horizontal'}  do |f| %>
      <%= f.text_field  :title, :class=> 'span6 input-large' %>
      <%= link_to 'Cancel', '#', :id => 'photo-title-cancel-btn', :class=>'btn' %>
      <%= f.submit 'Update title',:class=>'btn btn-primary' %>
    <% end %>
  <% end %>
</div>

<!-- photo view and description -->
<div class="row-fluid">
  <div class="span12">
    <div class="navbar">
      <!-- menubar for photo -->
      <div class="navbar-inner">
        <ul class="nav">
          <li class="dropdown">
            <a href="#" class="dropdown-toggle" data-toggle="dropdown">Photo<b class="caret"></b></a>
              <ul class="dropdown-menu">
                <li><%= link_to 'Other Versions', photo_version_path(@persona.screen_name, @photo.id) %></li>
                <li><%= link_to 'Launch Editor', photo_editor_path(@photo.id) %></li>
                <li><%= link_to 'Exif Data', photo_view_exif_path(@persona.screen_name, @photo.id) %></li>
                <% if persona_signed_in? && current_persona.id == @persona.id then %>
                  <li><%= link_to 'Add/Remove to Mediaset', '#addToSetModal', :'data-toggle'=>'modal' %></li>
                  <li class="divider"></li>
                  <li><%= link_to 'Delete this photo', photo_path(@photo), 
                    :method => 'delete', 
                    :data => { :confirm => t('.confirm', :default => t("helpers.links.confirm", :default => 'Are you sure?')) }
                    %></li>
                <% end %>
              </ul>
          </li>
        </ul>
      </div>
    </div><!-- navbar -->
    <div class="">
      <!-- picture description -->
      <div style="text-align=center;">
        <%= image_tag @photo.avatar.xlarge %>
      </div>
      <div>
        by <%= link_to @persona.screen_name, persona_path(@persona.screen_name) %>
      </div>
      <div>
        <p id="photo-desc"><%= @photo.description == nil ? 'No Description' : @photo.description %></p>
        <% if persona_signed_in? && current_persona.id == @persona.id then %>
          <%= form_for @photo, :html => { :id => 'photo-desc-form' } do |f| %>
            <%= f.text_area :description, :size => '80x6', :class=>'span9' %> 
            <br />
            <%= link_to 'Cancel', '#photo-desc', :id=>'photo-desc-cancel-btn', :class=>'btn' %>
            <%= f.submit nil, :class=>'btn btn-primary' %>
          <% end %>
        <% end %>
      </div>
    </div>
  </div><!-- span12 -->
</div><!-- row -->

<!-- photo coverflow -->
<div class="accordion" id="accordion2">
  <div class="accordion-group">
      <!-- show which mediasets this photo belongs to -->
    <div class="accordion-heading">
      <h3>
        <%= link_to '<i class="icon-chevron-down"></i>'.html_safe, '#collapseDefault', 
          :class=>'accordion-toggle', :'data-toggle'=>'collapse', :'data-parent'=>"#accordion2", 
          :style=>'display:inline;'  %><%= link_to 'Default', photo_path(@persona.screen_name) %>
      </h3>
    </div>
    <div class="accordion-body collapse" id="collapseDefault">
      <div class="accordion-inner">
          <% @photolist = get_photo_list(@persona.id, @photo.id, nil) %>
          <%= render "coverflow" %>
      </div>
    </div>
  </div>
  <% @photo.mediasets.each do |mediaset| %>
    <div class="accordion-group">  
      <div class="accordion-heading">
        <h3>
        <%= link_to '<i class="icon-chevron-down"></i>'.html_safe, '#collapse'+mediaset.id.to_s, 
          :class=>'accordion-toggle', :'data-toggle'=>'collapse', :'data-parent'=>'#accordion2', 
          :style=>'display:inline;' %><%= link_to mediaset.title, view_sets_path(@persona.screen_name, mediaset) %>
        </h3>
      </div>
      <div class="accordion-body collapse" id="collapse<%= mediaset.id %>">
        <% @photolist = get_photo_list(@persona.id, @photo.id, mediaset.id) %>
        <%= render "coverflow" %>
      </div>
  <% end %>
</div>


<!-- modal for updating mediaset selection -->
<%= render "updateMediasetModal" %>

<% if persona_signed_in? && @persona.id == current_persona.id then %>
  <script type="text/javascript">
    $(document).ready(function(){
      //hide all the forms
      $("#photo-title-form").hide();
      $("#photo-desc-form").hide();
      
      //click event
      $("#photo-title").click(function (event){
        $("#photo-title").hide("slow");
        $("#photo-title-form").show("slow");
      });
      $("#photo-title-cancel-btn").click(function (event){
        $("#photo-title").show("slow");
        $("#photo-title-form").hide("slow");
      });
      $("#photo-desc").click(function (event){
        $("#photo-desc").hide("slow");
        $("#photo-desc-form").show("slow"); 
      });
      $("#photo-desc-cancel-btn").click(function (event){
        $("#photo-desc").show("slow");
        $("#photo-desc-form").hide("slow"); 
      });
  
      $('.accordion-toggle').blur(function (){
        console.log('blur called');
      });
 
    });
  </script>


<% end %>

<%= link_to 'List Mediaset', mediasets_path, :remote=>true, :class=>'btn' %>
<div id="mediasetlist">
</div>

var handle = $('.endless_scroll_inner_wrap');

<% if  !@next_photos.empty? then %>
  //add new photos
  <% @next_photos.each do |photo| %>
    <% this_persona = Persona.find(photo.persona_id).screen_name %>
    var carousel = jQuery('<div/>', {class:'carousel', id:'photo_<%= photo.id %>',  
      style:'float:left; margin: 0px 2px 2px 0px;'}).
      append(jQuery('<div/>', {class:'carousel-inner'}));
    carousel.append("<%= escape_javascript(link_to image_tag(photo.avatar.versions[@options[:size].to_sym], :class=>'img-polaroid'), photo_view_path(this_persona, photo)) %>");
    var caption = jQuery('<div/>', {class:'carousel-caption', style:'color:white'});
    caption.append(jQuery('<div/>',  {text:'<%= escape_javascript(truncate(photo.title, :length => 20)) %> by ', class:'pull-left caption-text'}));
    caption.find('.caption-text').append(jQuery('<a/>', {text:'<%= this_persona %>', 
      href:'<%= escape_javascript(persona_path(this_persona)) %>'}));
    caption.append(jQuery('<div/>', {class:'caption-vote pull-right'}))
    <% if persona_signed_in? && current_persona.id == photo.persona_id then %>
      caption.find('.caption-vote').append(jQuery('<a/>', 
        {href:'<%= photo_toggle_featured_path(photo) %>', 'data-remote':'true', 'data-method':'post'}).append(jQuery('<i/> ', 
        {class:'isFeatured <%= photo.featured ? 'icon-star' : 'icon-star-empty' %>'}))); 
      caption.find('.caption-vote').find('a').append(' ');
    <% end %>
    var voteBox = jQuery('<div/>', {class:'pull-right voteBox'});
    <% if persona_signed_in? && !current_persona.voted?(photo) then %>
      voteBox.append(jQuery('<a/>', { href:'<%= escape_javascript photo_vote_path(photo, "up", current_persona.screen_name) %>', 'data-remote':true, 'data-method':'post', rel:'nofollow' }).append(jQuery('<i/>', {class:'icon-thumbs-up'})));
      voteBox.append(' ');
      voteBox.append(jQuery('<a/>', { href:'<%= escape_javascript photo_vote_path(photo, "down", current_persona.screen_name) %>', 'data-remote':true, 'data-method':'post', rel:'nofollow' }).append(jQuery('<i/>', {class:'icon-thumbs-down'})));
    <% elsif persona_signed_in? && current_persona.voted?(photo) then %>
      voteBox.append(jQuery('<a/>', {href:'<%= escape_javascript photo_unvote_path(photo, current_persona.screen_name) %>', 'data-remote':true, 'data-method':'post', rel:'nofollow'}).append(jQuery('<i/>', { class:'icon-thumbs-<%= current_persona.up_voted?(photo) ? "up" : "down" %>'} )));
    <% end %>
    caption.append(voteBox);
    caption.wrapInner('<h5/>');
    carousel.append(caption);

    $('.endless_scroll_inner_wrap').append(carousel);
    $('.endless-photos').attr('last', <%= @next_photos.last.id %>);

    $('.carousel-caption').hide();
    $('.carousel').hover( function(){
        $(this).find('.carousel-caption').show();
      }, function() {
        $(this).find('.carousel-caption').hide();
    });
  <% end %>
<% else %>
  //remove the end 
  handle.append(jQuery( '<div/>', {text:'Nothing here' } )); 
<% end %>

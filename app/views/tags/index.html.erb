<% if persona.nil? then %> 
  <% content_for :title, 'trendy tags' %>
  <div class="page-header">
    <h1>Trendy Tags for the past 24 hours</h1>
  </div>
<% else %>
  <% content_for :title, persona.screen_name + ' - tags' %>
  <% @focus = 'tags' %>
  <%= render :partial => "common/personaHeaderBar" %>
<% end %>

<div class="row-fluid" id="trendytags">
  <ul class="nav nav-tabs">
    <li id="last24h" class="active"><%= link_to 'Since yesterday', '#', :id => 'last24h' %></li>
    <li id="last1w"><%= link_to 'Since Last Week', '#' %></li>
    <li id="last1m"><%= link_to 'Since Last Month', '#' %></li>
    <li id="dawnoftime"><%= link_to 'From Begining of Time', '#' %></li>
  </ul>
</div>
<div class"row-fluid">
  <div class="span8">
    <table class="table">
      <thead>
        <tr>
          <th>No</th>
          <th>Tag</th>
          <th>Count</th>
        </tr>
      </thead>
      <tbody id="tagcontent">
      <% number = 1 %>
      <% tags.each do |tag| %>
        <tr>
          <td><%= number %></td>
          <% number += 1 %> 
          <td>
            <i class="icon-tag"></i> 
            <% if persona.nil? then %>
              <%= link_to tag.name, tag_path(tag.name) %>
            <% else %>
              <%= link_to tag.name, persona_show_tag_path(persona.screen_name, tag.name) %>
            <% end %>
          </td>
          <td>
            <%= tag.count %>
          </td>
        </tr>
      <% end %>
      </tbody>
    </table>
  </div>
</div>
<script type="text/javascript">
  $(document).ready( function(){
    $('#trendytags li').click( function(){
      $('.active').toggleClass('active');
      $(this).toggleClass('active');

      var dateRange = '1d';
      if ( $('#last24h').hasClass('active') ) {
        dateRange = '1d'; 
      } else if ( $('#last1w').hasClass('active') ) {
        dateRange = '1w'; 
      } else if ( $('#last1m').hasClass('active') ) {
        dateRange = '1m'; 
      } else if ( $('#dawnoftime').hasClass('active') ) {
        dateRange = 'forever'; 
      }
   
      <% if persona.nil? then %>
        sendParams = { new_range:dateRange }
      <% else %>
        sendParams = { new_range:dateRange, persona:<%= persona.id %> }
      <% end %> 

      //reload tags
      $('#tagcontent').empty();
      $.ajax({
        url: '/tags/get_more',
        data: sendParams, 
        dataType: 'script'
      });
    });

  });
</script>

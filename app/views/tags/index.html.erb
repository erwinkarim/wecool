<% if persona.nil? then %> 
  <% content_for :title, 'trendy tags' %>
  <div class="page-header">
    <h1><i class="icon-tags"></i> Tags</h1>
  </div>
<% else %>
  <% content_for :title, persona.screen_name + ' - tags' %>
  <% @focus = 'tags' %>
  <%= render :partial => "common/personaHeaderBar" %>
<% end %>

<div class="row-fluid navbar">
  <div class="navbar-inner">
    <ul class="nav" id="trendytags">
      <li class="active" id="recentTags"><a href="#">Recent</a></li>
      <li id="trendyTags"><a href="#">Trending</a></li>
    </ul>
  </div>
</div>
<div id="tagsResults" class"row-fluid">
  <div class="span8">
    <table class="table">
      <thead>
        <tr>
          <th>No</th>
          <th>Tag</th>
        </tr>
      </thead>
      <tbody id="tagcontent">
      <% number = 1 %>
      <% tags.each do |tag| %>
        <tr>
          <td><%= number %></td>
          <% number += 1 %> 
          <td>
            <i class="icon-tag"></i> 
            <% if persona.nil? then %>
              <%= link_to tag, tag_path(tag) %>
            <% else %>
              <%= link_to tag, persona_show_tag_path(persona.screen_name, tag) %>
            <% end %>
          </td>
        </tr>
      <% end %>
      </tbody>
    </table>
  </div>
</div>
<script type="text/javascript">
  $(document).ready( function(){
    $('#tagsResults').css('min-height', $(window).height()); 
    var sendParams = { mode: 'recent' } 

    $('#trendytags li').click( function(event){
      event.preventDefault();
      $('.active').toggleClass('active');
      $(this).toggleClass('active');
      sendParams['mode'] = $('#recentTags').hasClass('active') ? 'recent' : 'trending';

      <% if !persona.nil? then %>
        sendParams['persona_range'] = '<%= persona.id %>';
      <% end %> 

      //reload tags
      $('#tagcontent').empty();
      $.ajax({
        url: '/tags/get_more',
        data: sendParams, 
        dataType: 'script'
      });
    });

  });
</script>

<div class="row-fluid">
  <h2 class="page-header"><%= @mediaset.title %><small> by <%= persona_signed_in? && current_persona == @persona ? 'you' : link_to(@persona.screen_name, persona_path(@persona.screen_name)) %></h2>
</div>
<div class="row-fluid" id="mediaset_<%= @mediaset.id %>">
  <div class="span9">
    <p class="lead"><%= @mediaset.description.nil? ? 'No Description' : @mediaset.description %></p>
  </div>
  <div class="span3">
    <div class="progress row-fluid">
      <% totalVotes = @mediaset.up_votes + @mediaset.down_votes %>
      <% if @mediaset.votes == 0 then %>
        <div class="bar bar-info" style="width:100%"></div>
      <% else %>
        <div class="bar bar-success" style="width:<%= (@mediaset.up_votes.to_f / totalVotes )*100 %>%"></div>
      <% end %>
      <div class="bar bar-danger" style="width:<%= (@mediaset.down_votes.to_f / totalVotes)*100 %>%"></div>
    </div><!-- progress -->
    <div class="totalVoteBox row-fluid">
      <%= pluralize @mediaset.votes, 'vote' %>
    </div>
    <div class="voteFeaturedBox row-fluid">
      <h4>
      <% if persona_signed_in? && current_persona == @persona then %>
        <!-- Set this mediaset as featured or not -->
        <div class="featuredBox pull-left span6">
          <%= link_to ('<i class="isFeatured icon-star' + 
            (@mediaset.featured ? '' : '-empty') + '"></i>').html_safe, 
            mediaset_toggle_featured_path(@mediaset), :method => :post, :remote => true %>
        </div>
      <% end %>
      <% if persona_signed_in? then %>
        <div class="voteBox pull-right span6" style="text-align:right">
          <% if current_persona.voted?(@mediaset) then %>
            <!-- vote on this mediaset -->
            Voted <i class="icon-thumbs-<%= current_persona.up_voted?(@mediaset) ? 'up' : 'down'  %>"></i> - 
            <%= link_to 'Unvote', mediaset_unvote_path(@mediaset, current_persona.screen_name), 
              :remote => true, :method => :post %>
          <% else %>
            <%= link_to '<i class="icon-thumbs-up"></i>'.html_safe, 
              mediaset_vote_path(@mediaset, 'up', current_persona.screen_name), :remote => true, :method => :post %>
            <%= link_to '<i class="icon-thumbs-down"></i>'.html_safe, 
              mediaset_vote_path(@mediaset, 'down', current_persona.screen_name), :remote => true, :method => :post %>
          <% end %>
        </div>
      <% end %>
      </h4>
    </div><!-- voteFeaturedBox-->
  </div>
</div>

<% if persona_signed_in? && current_persona.screen_name == params[:persona_id] then %>
<br />
<div class="navbar">
  <div class="navbar-inner">
    <ul class="nav">
      <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Mediaset<b class="caret"></b></a>
          <ul class="dropdown-menu">
            <li><%= link_to t('.back', :default => t("helpers.links.back")),
               mediaset_path(params[:persona_id])   %></li>
            <li><%= link_to 'Edit', edit_mediaset_path(params[:persona_id], params[:id]) %></li>
            <li class="divider"></li>
            <li><%= link_to t('.destroy', :default => t("helpers.links.destroy")),
              mediaset_path(@mediaset),
              :method => 'delete',
              :data => { :confirm => t('.confirm', 
                :default => t("helpers.links.confirm", :default => 'Are you sure?')) } %></li>
          </ul>
      </li>
    </ul>
  </div>
</div>
<% end %>
<div class="row-fluid endless-photos" last="<%= @mediaset_photos.first.id %>" >
  <% if  @mediaset_photos.empty? then %>
    <h2>No photos on this set, why don't you 
      <%= link_to 'add some...', edit_mediaset_path(@persona.screen_name, @mediaset) %>
  <% else %>
      <div class="row-fluid endless-photos" last="<%= @mediaset_photos.first.id %>" >
        <div class="last-div endless_scroll_inner_wrap"></div>
      </div>
  <% end %>  
</div>
<div class="row-fluid">
  <p><%= pluralize @mediaset.photos.count, 'photo' %> </p>
</div>
<script type="text/javascript">
  //load first 10
  $.ajax({
    url: '/photos/get_more/<%= @mediaset_photos.first.id %>', 
    data: {limit:10, size:'small', includeFirst:'true', mediatype:'mediaset', mediaset_id:'<%= @mediaset.id %>'}, 
    dataType: 'script'
  });

  //load the rest as you scroll
  $(document).endlessScroll({
    fireOnce: true,
    fireDelay: 500, 
    bottomPixels: 50, 
    intervalFrequency: 100, 
    ceaseFireOnEmpty: false, 
    ceaseFire: function(){
      return $('.last-div').length ? false : true ;
    }, 
    loader: '<div>loading...</div>', 
    callback: function(){
        $.ajax({
          url: '/photos/get_more/'+$('.endless-photos').attr('last'), 
          dataType: 'script', 
          data: { mediatype:'mediaset', mediaset_id:'<%= @mediaset.id %>', 
            size:'small', limit:4
          }
        });
    }, 
    ceaseFire: function(s){
      s<5 ? false : true;
    }
  });
</script>

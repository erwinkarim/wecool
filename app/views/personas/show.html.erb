<%- model_class = Persona -%>
<% @focus = 'profile' %>
<%= render "common/personaHeaderBar" %>

<div class="row-fluid">
  <div class="span3 well">
    <div class="row-fluid">
      <dl class="dl-horizontal">
        <% if persona_signed_in? && current_persona != @persona then %>
          <dt><strong>Tracking:</strong></dt>
          <dd class="trackBox">
          <% if current_persona.tracks 'persona', @persona then %>
            Tracking <%= @persona.screen_name %> - <%= link_to 'Untrack', tracker_untrack_path('persona', @persona), 
              :remote=> true, :method=> :post %>
          <% else %>
            <%= link_to 'Track photos by ' + @persona.screen_name, tracker_track_path('persona', @persona ), 
              :remote=>true, :method => :post %>
          <% end %>
          </dd>
        <% end %>
        <dt><strong><%= model_class.human_attribute_name(:realname) %>:</strong></dt>
        <dd><%= @persona.realname.nil? ? 'Not set' : @persona.realname %></dd>
        <dt><strong><%= model_class.human_attribute_name(:screen_name) %>:</strong></dt>
        <dd><%= @persona.screen_name %></dd>
      </dl>
    </div>
    <div class="row-fluid">
      <h4>Trackers (<%= @trackers.count %>)</h4>
      <div class="row-fluid">
        <% @trackers.each do |tracker| %>
          <%= link_to image_tag(tracker.avatar.normal.url.nil? ? 'http://placehold.it/75x75' : tracker.avatar.normal), 
            persona_path(tracker.screen_name), :title => tracker.screen_name, :class=>'pull-left', :style=> 'margin: 4px;' %> 
        <% end %>
      </div>
      <div class="row-fluid">
        <%= link_to 'see more...', tracker_path(@persona.screen_name) %>
      </div>
    </div>
    <div class="row-fluid">
      <h4>Tracking (<%= @tracking.count %>)</h4>
      <div class="row-fluid">
        <% @tracking.each do |tracking_p| %>
          <%= link_to image_tag(tracking_p.avatar.normal.url.nil? ? 'http://placehold.it/75x75' : tracking_p.avatar.normal), 
            persona_path(tracking_p.screen_name), :title => tracking_p.screen_name, 
            :class => 'pull-left', :style => 'margin:4px;' %>
        <% end %>
      </div>
      <div class="row-fluid">
        <%= link_to 'see more...', tracker_path(@persona.screen_name) %>
      </div>
    </div>
  </div>
  <div class="span9">
    <div>
      <h2>Photos <small><%= link_to 'See More...', photo_path(@persona.screen_name) %> </small></h2>
      <div class="row-fluid endless_scroll_inner_wrap">
      </div>
      <div>
        <%= link_to 'See More Photos...', photo_path(@persona.screen_name), :class=>'btn' %>
      </div>
    </div>
    <div>
      <h2>Mediasets</h2>
      <div class="well">
      <% if @persona.mediasets.empty? then %>
        <% if current_persona == @persona then %>
          <h3>You don't have any mediasets yet, <%= link_to 'make some', new_mediaset_path %></h3>
        <% else %>
          <h3>No mediasets yet</h3>
        <% end %>
      <% else %>
        <% @persona.mediasets.find(:all, :order => 'id desc', :limit => 5).each do |mediaset| %>
            <div style="display:block; margin:0px auto; ">
              <h3><%= link_to mediaset.title, view_sets_path(@persona.screen_name, mediaset.id) %></h3>
              <% Mediaset.joins{ mediaset_photos }.find(mediaset.id).
                photos.order('mediaset_photos."order"').limit(4).each do |photo| %>
                <%= link_to image_tag(photo.avatar.square200, :class=>'img-polaroid'), 
                  photo_view_path(@persona.screen_name, photo.id)  %>
              <% end %>
            </div>
        <% end %>
        <br />
        <p><%= link_to 'See More Mediasets', mediaset_path(@persona.screen_name), :class=>'btn' %></p>
      <% end %>
      </div>
    </div>
  </div>
</div>
<script type="text/javascript">
  $.ajax({
    url: '/photos/get_more/<%= Photo.last.id %>',
    data: { limit:10, mediatype:'featured',  author:'<%= @persona.screen_name %>', includeFirst:'true', size:'tiny', featured:true },
    dataType: 'script'
  });
</script>
